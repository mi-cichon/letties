<div class="lobby-container">
  <div class="main-area">
    <div class="seats-layout">
      <div class="seats-grid">
        @for (seat of sortedSeats(); track seat.seatId) {
          @let botInfo = seat.playerId! | getBotInfo: lobbyState()!.players!;
          <div class="seat-card" [class.occupied]="seat.playerId">
            <div class="seat-header">
              <span class="seat-num"
                >#{{ seat.order }}
                @if (seat.isAdmin) {
                  <span class="admin-icon" title="Host">üëë</span>
                }

                @if (botInfo.isBot) {
                  <span class="bot-icon" title="Bot">ü§ñ {{ botInfo.difficultyText }}</span>
                }
              </span>

              @if (seat.playerId == null && amIAdmin()) {
                <button class="bot-control add-bot" (click)="onAddBotClick(seat.seatId!)">
                  {{ 'lobby.addBot' | transloco }}
                </button>
              }
              @if (seat.playerId != null && amIAdmin() && botInfo.isBot) {
                <button class="bot-control remove-bot" (click)="onRemoveBot(seat.seatId!)">
                  {{ 'lobby.removeBot' | transloco }}
                </button>
              }
            </div>

            <div class="seat-content">
              @if (seat.playerId) {
                <span class="player-name">{{ getPlayerName(seat.playerId) }}</span>
              } @else {
                <button class="join-seat-btn" (click)="onTakeSeat(seat.seatId!)">
                  {{ 'lobby.takeSeat' | transloco }}
                </button>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <div class="spectators-section">
      <h3>{{ 'lobby.spectators' | transloco }}</h3>
      <div class="spectators-list">
        @for (p of getSpectators(); track p.playerId) {
          <span class="spectator-tag">{{ p.playerName }}</span>
        } @empty {
          <span class="no-spectators">- brak widz√≥w -</span>
        }
      </div>
    </div>
  </div>

  @if (amIAdmin()) {
    <div class="side-panel">
      <div class="admin-settings-panel animate-in">
        <div class="panel-header">
          <span class="icon">‚öôÔ∏è</span>
          <h3>{{ 'lobby.gameSettings' | transloco }}</h3>
        </div>

        <div class="settings-grid">
          <div class="setting-item">
            <label>{{ 'lobby.language' | transloco }}</label>
            <div class="btn-group">
              <button
                [class.active]="lobbyState()?.settings?.language === gameLanguage.Polish"
                (click)="updateSetting('language', gameLanguage.Polish)"
              >
                PL
              </button>
              <button
                [class.active]="lobbyState()?.settings?.language === gameLanguage.English"
                (click)="updateSetting('language', gameLanguage.English)"
              >
                EN
              </button>
            </div>
          </div>

          <div class="setting-item">
            <label>{{ 'lobby.timeBank' | transloco }} (min)</label>
            <select
              [value]="lobbyState()?.settings?.timeBank"
              (change)="updateSetting('timeBank', parseInt($any($event.target).value))"
            >
              <option value="3">3</option>
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="15">15</option>
              <option value="20">20</option>
              <option value="25">25</option>
              <option value="30">30</option>
              <option value="40">40</option>
              <option value="50">50</option>
              <option value="60">60</option>
            </select>
          </div>

          <div class="setting-item full-width">
            <label>{{ 'lobby.totalTiles' | transloco }}</label>
            <div class="range-wrapper">
              <input
                type="range"
                min="50"
                max="200"
                step="10"
                [value]="lobbyState()?.settings?.tilesCount"
                (change)="updateSetting('tilesCount', parseInt($any($event.target).value))"
              />
              <span class="val">{{ lobbyState()?.settings?.tilesCount }}</span>
            </div>
          </div>

          <div class="setting-item full-width">
            <label>{{ 'lobby.boardType' | transloco }}</label>
            <div class="btn-group vertical">
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.Classic"
                (click)="updateSetting('boardType', boardType.Classic)"
              >
                {{ 'lobby.boardClassic' | transloco }}
              </button>
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.Arena"
                (click)="updateSetting('boardType', boardType.Arena)"
              >
                {{ 'lobby.boardArena' | transloco }}
              </button>
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.Wildlands"
                (click)="updateSetting('boardType', boardType.Wildlands)"
              >
                {{ 'lobby.boardWildlands' | transloco }}
              </button>
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.BigClassic"
                (click)="updateSetting('boardType', boardType.BigClassic)"
              >
                {{ 'lobby.boardBigClassic' | transloco }}
              </button>
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.Crossfire"
                (click)="updateSetting('boardType', boardType.Crossfire)"
              >
                {{ 'lobby.boardCrossfire' | transloco }}
              </button>
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.Islands"
                (click)="updateSetting('boardType', boardType.Islands)"
              >
                {{ 'lobby.boardIslands' | transloco }}
              </button>
              <button
                [class.active]="lobbyState()?.settings?.boardType === boardType.Stronghold"
                (click)="updateSetting('boardType', boardType.Stronghold)"
              >
                {{ 'lobby.boardStronghold' | transloco }}
              </button>
            </div>
          </div>
        </div>

        <button class="start-game-btn" [disabled]="!canStartGame()" (click)="onStartGame()">
          {{ 'lobby.startGame' | transloco }}
          @if (amIAdmin() && seatedPlayersCount() < 2) {
            <span class="btn-hint">({{ 'lobby.needMorePlayers' | transloco }})</span>
          }
        </button>
      </div>
    </div>
  }
</div>
@if (addingBotToSeatId()) {
  <div class="modal-backdrop" (click)="closeBotModal()">
    <div class="bot-modal animate-in" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ 'lobby.bot.selectLevel' | transloco }}</h3>
      </div>

      <div class="difficulty-cards">
        <div
          class="diff-card"
          [class.active]="selectedBotDifficulty() === BotDifficulty.Easy"
          (click)="selectBotDifficulty(BotDifficulty.Easy)"
        >
          <div class="icon">üê£</div>
          <div class="info">
            <span class="lvl">{{ 'lobby.bot.easy' | transloco }}</span>
            <span class="desc">{{ 'lobby.bot.easyDesc' | transloco }}</span>
          </div>
        </div>

        <div
          class="diff-card"
          [class.active]="selectedBotDifficulty() === BotDifficulty.Medium"
          (click)="selectBotDifficulty(BotDifficulty.Medium)"
        >
          <div class="icon">üë§</div>
          <div class="info">
            <span class="lvl">{{ 'lobby.bot.medium' | transloco }}</span>
            <span class="desc">{{ 'lobby.bot.mediumDesc' | transloco }}</span>
          </div>
        </div>

        <div
          class="diff-card"
          [class.active]="selectedBotDifficulty() === BotDifficulty.Hard"
          (click)="selectBotDifficulty(BotDifficulty.Hard)"
        >
          <div class="icon">ü§ñ</div>
          <div class="info">
            <span class="lvl">{{ 'lobby.bot.hard' | transloco }}</span>
            <span class="desc">{{ 'lobby.bot.hardDesc' | transloco }}</span>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="cancel" (click)="closeBotModal()">
          {{ 'lobby.cancel' | transloco }}
        </button>
        <button class="confirm" (click)="confirmAddBot()">
          {{ 'lobby.addBot' | transloco }}
        </button>
      </div>
    </div>
  </div>
}
